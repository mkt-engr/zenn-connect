# 注意

**_このマークダウンは公開しないこと_**
アイデアを整理するのに用いる

# 参考

これを見てこの記事を書こうと思った

https://bespoyasov.me/blog/clean-architecture-on-frontend

# やりたいこと

- FE でクリーンアーキテクチャーを実現
  - 下記のようなアーキテクチャにすることが目標
    - テスト容易性
    - 変更容易性
- バッドプラクティスの場合どんな感じでテストが書きづらいかも示したい
- eslint でフォルダの読み込みの違反を検知したい

# 題材とするシステム

図書館のシステム

- 本を予約
- 予約されたらメール通知
- 本の検索
- 本のリクエスト
- お気に入りの本の設定

# 本の構成

1. はじめに：題材と設計ゴール
2. 雛形作成（Vite + React + TypeScript）
3. interface を使わない契約設計
4. Domain 設計：図書館の不変条件
5. Books 機能 ①（検索）
6. Reservations 機能 ①（本を予約）
7. Notifications 機能（メール送信の抽象）
8. Requests 機能（新刊リクエスト）
9. Auth 機能（ログイン／ログアウト）
10. Infrastructure 差し替え ①（Prisma 導入）
11. Infrastructure 差し替え ②（最小 API・外部通知）
12. テスト戦略（総まとめ）
13. 変更デモ（タグ機能 or 貸出期限）
14. まとめ & 付録

# フォルダ構成

```bash
src/
  app/                  # ルータ, DI初期化, QueryClient, グローバルProvider等
  shared/               # どのfeatureにも依存しない共通（型・ユーティリティ・UI）
    domain/             # 値オブジェクト, 結果型, エラー, 時刻/ID生成ポリシー
    application/        # 共通ユースケースI/O型, ポート（例: MailServicePort）
    infrastructure/     # 汎用実装（fetchクライアント, Mailアダプタの基底など）
    presentation/       # デザイン系Atoms（Button等）※ビジネスに依存しない
  features/
    auth/                      # ← 新規 feature
      domain/
        types.ts               # AuthUser, Token, セッション不変条件
        rules.ts               # 期限切れ判定などの純関数
      application/
        ports.ts               # 認証ポート（関数の集合）
        usecases/
          login.ts             # login(deps)(credentials)
          logout.ts            # logout(deps)()
          get-session.ts       # 現在のセッション取得
      infrastructure/
        inmemory.ts            # メモリ実装（開発用）
        http.ts                # /auth/login /auth/logout を叩く実装
        storage.ts             # Web Storage/ Cookie アダプタ
      presentation/
        LoginForm.tsx          # フォーム（薄い）
        LogoutButton.tsx
        AuthGate.tsx           # ルートガード/子を囲う
      index.ts                 # 外に出すのは usecase と型だけ
    books/              # 本（検索・詳細・作成など）
      domain/           # Book, BookId, BookRepository(ポート)
      application/      # UseCases: SearchBooks, GetBook
      presentation/     # React: pages/components/hooks（薄い）
      infrastructure/   # BookRepositoryの実装: Prisma/HTTP/InMemory
      index.ts          # エクスポート（barrel）
    reservations/       # 予約（作成/一覧/取り消し）
      domain/           # Reservation, ReservationPolicy など
      application/      # ReserveBook, ListReservations
      presentation/     # UI
      infrastructure/   # ReservationRepository実装
      index.ts
    requests/           # 新刊リクエスト
      domain/
      application/
      presentation/
      infrastructure/
      index.ts
    users/              # 利用者（必要なら）
      ...

```
